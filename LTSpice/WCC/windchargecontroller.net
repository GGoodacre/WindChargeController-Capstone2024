* C:\Users\HP USER\Documents\BCIT\7000\WindChargeController-Capstone2024\LTSpice\WCC\windchargecontroller.asc
V1 N001 0 12 Rser=0
R§Battery_Req Vout_1 N001 0.02
XX5 Vdcdc 0 Vsupply Vsupply Vout_1 Vout_2 Vout_3 powerswitch
R2 Vout_2 0 5
R3 Vout_3 0 1
V4 Vsupply 0 10
XX7 Va Vb Vc N002 killswitch
XX1 Vsqr 0 swgen params: duty=40 Freq=300k Von=5
XX6 Va Vb Vc 3phgen params: turbVolt=20 turbR=0.1 turbFreq=1000
XX8 0 Va Vb Vc Vrect 0 brakerectifier
XX9 Vpwm Vrect 0 Vdcdc sepic params: L1=2.333mH L2=2.333mH C1=10uF Ci=100uF Co=1000uF Cd=40uF Rd=2.44
XX2 Vsupply Vsqr 0 Vpwm mosdrive
V2 N002 0 PWL(0 0 24ms 0 25ms 10)

* block symbol definitions
.subckt powerswitch PowerIn S1 S2 S3 Power1 Power2 Power3
M1 Power1 S1 N001 N001 SQ4401EY
D1 PowerIn N001 MBR745
M2 Power2 S2 N002 N002 SQ4401EY
D2 PowerIn N002 MBR745
M3 Power3 S3 N003 N003 SQ4401EY
D3 PowerIn N003 MBR745
.ends powerswitch

.subckt killswitch Phase_A Phase_B Phase_C Power
S1 Phase_C N001 Power COM MYSW
S2 Phase_B N001 Power COM MYSW
S3 Phase_A N001 Power COM MYSW
.model MYSW SW(Ron=1 Roff=10Meg Vt=0.5 Vh=-0.4)
.ends killswitch

.subckt swgen V+ V-
V1 V+ V- PULSE(0 {Von} 0 0 0 {Ton} {TPeriod})
.param TPeriod = 1/Freq
.param Ton = TPeriod*duty/100
.ends swgen

.subckt 3phgen Phase_A Phase_B Phase_C
V1 Phase_A Phase_B SINE(0 {turbVolt} {turbFreq} 0 0 0) Rser={turbR}
V2 Phase_B Phase_C SINE(0 {turbVolt} {turbFreq} 0 0 120) Rser={turbR}
V3 Phase_C Phase_A SINE(0 {turbVolt} {turbFreq} 0 0 240) Rser={turbR}
.param turbVolt = turbVolt
.param turbFreq = turbFreq
.param turbR = turbR
.ends 3phgen

.subckt brakerectifier Brake Phase_A Phase_B Phase_C VDC+ VDC-
D1 Phase_A VDC+ 1N914
D2 Phase_B VDC+ 1N914
D3 Phase_C VDC+ 1N914
M1 Phase_A N001 VDC- VDC- Si7336ADP
M2 Phase_B N002 VDC- VDC- Si7336ADP
M3 Phase_C N003 VDC- VDC- Si7336ADP
R1 Brake N001 {R1}
R2 Brake N002 {R1}
R3 Brake N003 {R1}
.param R1 = 16
.ends brakerectifier

.subckt sepic PWM Vin+ Vin- Vout
Ci Vin+ Vin- {Ci}
L2 N003 Vin- {L2}
Co Vout Vin- {Co}
D1 N003 Vout D
L1 N001 Vin+ {L1}
C1 N003 N001 {C1}
Cd N002 N001 {Cd}
Rd N003 N002 {Rd}
R1 PWM Vin- 1Mega
M1 N001 PWM Vin- Vin- Si7336ADP
.params L1=L1 L2=L2 C1=C1 Ci=Ci Co=Co Cd=Cd Rd=Rd
K1 L1 L2 0.98
.ends sepic

.subckt mosdrive Vdrv Vpwm Vref Vgate
Q1 Vdrv N001 N002 0 2N5210
Q2 Vref N001 N002 0 2N5087
R1 Vgate N002 {R1}
R2 N001 Vpwm {R2}
.param R1=1m R2=1m
.ends mosdrive

.model D D
.lib C:\Users\HP USER\Documents\LTspiceXVII\lib\cmp\standard.dio
.model NPN NPN
.model PNP PNP
.lib C:\Users\HP USER\Documents\LTspiceXVII\lib\cmp\standard.bjt
.model NMOS NMOS
.model PMOS PMOS
.lib C:\Users\HP USER\Documents\LTspiceXVII\lib\cmp\standard.mos
.tran 50ms startup
* brake at 25ms
.backanno
.end
